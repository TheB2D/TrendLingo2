"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.stringifyStructuredOutput = stringifyStructuredOutput;
exports.parseStructuredTaskOutput = parseStructuredTaskOutput;
const tslib_1 = require("../internal/tslib.js");
const zod_1 = tslib_1.__importDefault(require("zod"));
function stringifyStructuredOutput(schema) {
    return JSON.stringify(zod_1.default.toJSONSchema(schema));
}
function parseStructuredTaskOutput(res, schema) {
    if (res.doneOutput == null) {
        return { ...res, parsedOutput: null };
    }
    try {
        const parsed = JSON.parse(res.doneOutput);
        const response = schema.safeParse(parsed);
        if (!response.success) {
            throw new Error(`Invalid structured output: ${response.error.message}`);
        }
        return { ...res, parsedOutput: response.data };
    }
    catch (e) {
        if (e instanceof SyntaxError) {
            return {
                ...res,
                parsedOutput: null,
            };
        }
        throw e;
    }
}
//# sourceMappingURL=parse.js.map